# PnLCalib: Sports Field Registration via Points and Lines Optimization
Extension of the previous paper "No Bells, Just Whistles: Sports Field Registration by Leveraging Geometric Properties"

<div align="center">
[![arXiv](https://img.shields.io/badge/arXiv-2207.11709-b31b1b.svg?style=for-the-badge)](https://arxiv.org/abs/2404.08401)
    
### Code to be released.

<p align="center"><img src=figures/FieldReconstruction-1.png  width=70% height=70%></p>

## Contents
- [Abstract](#abstract)
- [Model Weights](#weights)
- [Inference / Demo](#inference)
- [Experiments](#experiments)
    - [Datasets](#datasets)
    - [Metrics](#metrics)
    - [Evaluation](#evaluation)
- [Requirements](#requirements)
- [Citation](#citation)

<hr>  

## Abstract
Camera calibration in broadcast sports videos presents numerous challenges for accurate sports field registration due to multiple camera angles, varying camera parameters, and frequent occlusions of the field. Traditional search-based methods depend on initial camera pose estimates, which can struggle in non-standard positions and dynamic environments. In response, we propose an optimization-based calibration pipeline that leverages a 3D soccer field model and a predefined set of keypoints to overcome these limitations. Our method also introduces a novel refinement module that improves initial calibration by using detected field lines in a non-linear optimization process. This approach outperforms existing techniques in both multi-view and single-view 3D camera calibration tasks, while maintaining competitive performance in homography estimation. Extensive experimentation on real-world soccer datasets, including SoccerNet-Calibration, WorldCup 2014, and TS-WorldCup, highlights the robustness and accuracy of our method across diverse broadcast scenarios. Our approach offers significant improvements in camera calibration precision and reliability.
<p align="center"><img src=figures/Pipeline_r-1.png  width=90% height=90%></p>
<strong>Overview of our proposed framework.</strong> Top: Training data generation pipeline. Beginning with SoccerNet annotations, we utilize field line
extraction and ellipse fitting to establish a hierarchical structure for computing each set of keypoints. Bottom: Inference stage pipeline. The encoder-decoder
networks produce heatmaps for keypoints and extremities of soccer field lines to extract their positions in the image space. The obtained keypoint set is
augmented with intersections of lines generated by the second model to ensure a sufficient number of points. After initial calibration, our PnL refinement
module is applied to further refine the calibration estimate by jointly using detected points and lines information.
